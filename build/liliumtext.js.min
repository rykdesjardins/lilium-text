"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var LiliumTextCommand=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"execute",value:function(){throw new Error("execute() method was not overridden in child class.")}},{key:"make",value:function(t){var i=this;this.editor=t;var e=document.createElement("i");if(e.className="liliumtext-topbar-command liliumtext-topbar-command-"+this.webName+" "+(this.cssClass||"liliumtext-topbar-noicon"),e.dataset.command=this.webName,this.text){var n=document.createElement("span");n.className="liliumtext-command-text",n.textContent=this.text,e.classList.add("liliumtext-command-withtext"),e.appendChild(n)}return e.addEventListener("mousedown",function(e){return e.preventDefault(),e.stopPropagation(),!1}),e.addEventListener("mouseup",function(e){return e.preventDefault(),e.stopPropagation(),t.log("Executed command "+i.webName+(i.param?" with parameter '"+i.param+"'":"")),t.fire("command",i.webName),i.execute(e,i,t),!1}),e}}]),e}(),LiliumTextWebCommand=function(e){function s(e,t,i,n,o){_classCallCheck(this,s);var r=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return r.webName=e,r.param=t,r.cssClass=i,r.imageURL=n,r.text=o,r}return _inherits(s,LiliumTextCommand),_createClass(s,[{key:"highlightNode",value:function(e){var t=this.editor.restoreSelection(),i=document.createRange();this.editor.log("Highlighting node "+e.nodeName+" from Web Command"),i.selectNode(e),t.removeAllRanges(),t.addRange(i),this.editor.storeRange(i)}},{key:"executeText",value:function(){var t=this,e=this.editor.restoreSelection(),i=this.param;if("Caret"==e.type){var n=this.editor.createSelectionContext(e.focusNode).find(function(e){return e.type==i});n&&(this.editor.log("Unwrapping element of node type "+i),this.editor.unwrap(n))}else if("Range"==e.type){var o=i.toUpperCase(),r=e.anchorNode.compareDocumentPosition(e.focusNode)&Node.DOCUMENT_POSITION_FOLLOWING?[e.anchorNode,e.focusNode]:[e.focusNode,e.anchorNode],s=_slicedToArray(r,2),a=s[0],l=s[1],c=[this.editor.createSelectionContext(a),this.editor.createSelectionContext(l)],h=c[1],u=[c[0].find(function(e){return e.nodeName==o}),h.find(function(e){return e.nodeName==o})],d=u[0],m=u[1];this.editor.log("Long logic with range using node type "+i);var f=e.getRangeAt(0).extractContents(),p=!d&&!m&&f.querySelectorAll(i);if(a.parentElement!==l.parentElement||d||p.length)if(!d!=!m){this.editor.log("XOR range wrapper extension of node type "+i);var g=document.createElement(i);g.appendChild(f),e.getRangeAt(0).insertNode(g);var v=d||m;Array.prototype.forEach.call(v.querySelectorAll(i),function(e){t.editor.unwrap(e)}),this.highlightNode(node)}else if(0!=p.length)this.editor.log("Fragment child unwrap with node type "+i),Array.prototype.forEach.call(p,function(e){for(;e.firstChild;)e.parentNode?e.parentNode.insertBefore(e.firstChild,e):f.insertBefore(e.firstChild,f)}),Array.prototype.forEach.call(p,function(e){return e&&e.remove&&e.remove()}),e.getRangeAt(0).insertNode(f);else if(d&&m&&d===m){this.editor.log("Placeholder unwrap from two sources with node types : "+i);var y=document.createElement("liliumtext-placeholder");e.getRangeAt(0).insertNode(y);var k=d,C=k.cloneNode(!0);k.parentNode.insertBefore(C,k);for(var b=C.querySelector("liliumtext-placeholder");b.nextSibling;)b.nextSibling.remove();for(;y.previousSibling;)y.previousSibling.remove();k.parentNode.insertBefore(f,k),y.remove(),b.remove(),this.highlightNode(C)}else if(d&&m){this.editor.log("Merge wrap from two sources with node types : "+i);for(var x=f.firstChild,w=f.lastChild;x.nextSibling!=w;)x.appendChild(x.nextSibling);for(;w.firstChild;)x.appendChild(w.firstChild);w.remove(),e.getRangeAt(0).insertNode(f)}else if(1==f.childNodes.length&&f.childNodes[0].nodeName==i){this.editor.log("Single unwrap of node type : "+i);for(var _=f.childNodes[0];_.lastChild;)e.getRangeAt(0).insertNode(_.lastChild)}else{this.editor.log("Fragment wrap with node type : "+i);var S=document.createElement(i);S.appendChild(f);var E=e.getRangeAt(0);E.insertNode(S),E.selectNode(S),e.removeAllRanges(),e.addRange(E)}else{this.editor.log("Quick range wrap with element of node type "+i);var T=document.createElement(i);T.appendChild(f),e.getRangeAt(0).insertNode(T),this.highlightNode(T)}}}},{key:"executeExec",value:function(){this.editor.restoreSelection(),document.execCommand(this.param)}},{key:"executeBlock",value:function(){var e=this.editor.restoreSelection(),t=e.getRangeAt(0),i=this.param,n=this.editor.createSelectionContext(e.focusNode),o=(this.editor.settings.blockelements,n&&n.length?n[n.length-1]:this.editor.contentel.children[e.focusOffset]);if(o.nodeName!=i){var r=document.createElement(i);if(o.parentElement.insertBefore(r,o),o.data)r.appendChild(o);else{for(;o.firstChild;)r.appendChild(o.firstChild);o.remove()}t.setStart(r,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}}},{key:"executeRemove",value:function(){if("a"==this.param)this.editor.restoreSelection(),document.execCommand("unlink",!1);else if(this.param){var e=this.editor.restoreSelection().focusNode.parentNode,t=this.editor.createSelectionContext(e),i=this.param.toUpperCase(),n=t.find(function(e){return e.nodeName==i});n&&(this.editor.log("Unwrapping node "+this.param),this.editor.unwrap(n))}else this.editor.log("Executing native command removeFormat"),this.editor.restoreSelection(),document.execCommand("removeFormat",!1,"")}},{key:"executeInsert",value:function(){var e=this.param,t=document.createElement(e),i=this.editor.restoreSelection(),n=i.focusNode;if(n==this.editor.contentel)this.editor.contentel.insertBefore(t,this.editor.contentel.children[i.focusOffset]);else{var o=this.editor.createSelectionContext(n),r=o[o.length-1];if(this.editor.contentel.insertBefore(t,r.nextElementSibling),0==i.focusOffset);else{var s=i.getRangeAt(0);s.setStart(t.nextElementSibling||r.nextElementSibling||t,0),s.collapse(!0),i.removeAllRanges(),i.addRange(s)}}}},{key:"execute",value:function(e){switch(this.webName){case"text":this.executeText();break;case"exec":this.executeExec();break;case"block":this.executeBlock();break;case"remove":this.executeRemove();break;case"insert":this.executeInsert();break;default:this.editor.log("Warning : Tried to execute command with unknown webName ["+this.webName+"]")}return this.editor.takeSnapshot(),e.stopPropagation(),e.preventDefault(),!1}}]),s}(),LiliumTextCustomCommand=function(e){function s(e,t,i,n,o){_classCallCheck(this,s);var r=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return r.webName=e,r.callback=t,r.cssClass=i,r.imageURL=n,r.text=o,r}return _inherits(s,LiliumTextCommand),_createClass(s,[{key:"execute",value:function(){return this.callback.apply(this,arguments)&&this.editor.takeSnapshot(),!1}}]),s}(),LiliumTextHistoryEntry=function(){function n(e){_classCallCheck(this,n),this.type=e}return _createClass(n,[{key:"undo",value:function(){}}],[{key:"makeStaticClassesBecauseJavascriptIsStillWeird",value:function(){n.ChildListHistoryEntry=function(e){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"ChildList"));return t.record=e,t.target=e.target,t.previousState=e.oldValue,t}return _inherits(i,n),i}(),n.TextHistoryEntry=function(e){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Text"));return t.record=e,t}return _inherits(i,n),i}(),n.AttributesHistoryEntry=function(e){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Attributes"));return t.record=e,t}return _inherits(i,n),i}(),n.AutomaticSnapshotEntry=function(e){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"AutomaticSnapshot"));return t.markup=e,t}return _inherits(i,n),_createClass(i,[{key:"undo",value:function(e){if(e.content!=this.markup)return e.content=this.markup,!0}}]),i}(),n.ManualSnapshotEntry=function(e){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"ManualSnapshot"));return t.markup=e,t}return _inherits(i,n),_createClass(i,[{key:"undo",value:function(e){if(e.content!=this.markup)return e.content=this.markup,!0}}]),i}()}},{key:"fromRecord",value:function(e){switch(e.type){case"childList":return new n.ChildListHistoryEntry(e);case"characterData":return new n.TextHistoryEntry(e);case"attributes":return new n.AttributesHistoryEntry(e)}}},{key:"fromSnapshot",value:function(e,t){return t?new n.ManualSnapshotEntry(e):new n.AutomaticSnapshotEntry(e)}}]),n}();LiliumTextHistoryEntry.makeStaticClassesBecauseJavascriptIsStillWeird();var LiliumTextPlugin=function(){function t(e){_classCallCheck(this,t),this.identifier=e,this.active=!1}return _createClass(t,[{key:"register",value:function(){}},{key:"unregister",value:function(){}}]),t}(),LiliumText=function(){function n(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,n),this.initat=window.performance.now(),this.initialized=!1,this.destroyed=!1,this.codeview=!1,this.focused=!1,this._historylastState="",this.hooks={},this._plugins=[],this.wrapperel="string"==typeof e?document.querySelector(e)||document.getElementById(e):e,!this.wrapperel)throw new Error("LiliumText - Invalid element, DOM selector, or DOM element ID.");this.id=this.wrapperel.id||"liliumtext-"+btoa(Math.random().toString()).slice(0,-2),(n.instances[this.id]=this).settings=Object.assign(n.defaultSettings,i),this.commandsets=this.settings.commandsets||n.createDefaultCommands(this),this.log=this.settings.dev?n.makeLogFunction():function(){},this.log("Created LiliumText instance"),this.log("Firing document event"),document.dispatchEvent(new CustomEvent("liliumTextCreated",{detail:this})),this.wrapperel.classList.add("liliumtext"),this.wrapperel.classList.add("theme-"+this.settings.theme),Object.keys(this.settings.hooks).forEach(function(e){t.bind(e,t.settings.hooks[e])}),this._init(),this.settings.initrender&&this.render(),this.log("Ready in "+(window.performance.now()-this.initat)+"ms")}return _createClass(n,null,[{key:"createDefaultCommands",value:function(e){return[[new LiliumTextWebCommand("text",e.settings.boldnode||"strong","far fa-bold"),new LiliumTextWebCommand("text",e.settings.italicnode||"em","far fa-italic"),new LiliumTextWebCommand("text",e.settings.underlinenode||"u","far fa-underline"),new LiliumTextWebCommand("text",e.settings.strikenode||"strike","far fa-strikethrough"),new LiliumTextWebCommand("remove",void 0,"far fa-eraser")],[new LiliumTextCustomCommand("undo",e.undo.bind(e),"far fa-undo"),new LiliumTextCustomCommand("redo",e.redo.bind(e),"far fa-redo")],[new LiliumTextWebCommand("block",e.settings.breaktag||"p","far fa-paragraph"),new LiliumTextWebCommand("block","h1","far fa-h1"),new LiliumTextWebCommand("block","h2","far fa-h2"),new LiliumTextWebCommand("block","h3","far fa-h3"),new LiliumTextWebCommand("block","blockquote","far fa-quote-right")],[new LiliumTextWebCommand("insert","hr","far fa-minus")],[new LiliumTextWebCommand("exec","insertOrderedList","far fa-list-ol"),new LiliumTextWebCommand("exec","insertUnorderedList","far fa-list-ul"),new LiliumTextWebCommand("remove","a","far fa-unlink")],[new LiliumTextCustomCommand("code",e.toggleCode.bind(e),"far fa-code")]]}},{key:"makeLogFunction",value:function(){return function(e){return console.log("[LiliumText] "+e)}}},{key:"defaultSettings",get:function(){return{initrender:!0,removepastedstyles:!0,dev:!1,hooks:{},plugins:[],theme:"minim",width:"auto",boldnode:"strong",italicnode:"em",historyInterval:5e3,maxHistoryStack:100,underlinenode:"u",strikenode:"strike",height:"420px",breaktag:"p",blockelements:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ol","ul","article","dd","dl","dt","figure","header","hr","main","section","table","tfoot"],inlineelements:["a","b","big","code","em","i","img","small","span","strong","sub","sup","time","var"],content:"",urldetection:/^((https?):\/)\/?([^:\/\s]+)((\/\w+)*\/?)([\w\-\.])+/i}}}]),_createClass(n,[{key:"destroy",value:function(e){for(this.fire("destroy");this.wrapperel.firstElementChild;)this.wrapperel.firstElementChild.remove();for(var t in e?delete n.instances[this.id]:n.instances[this.id]=void 0,this)this[t]=void 0;this.destroyed=!0,document.dispatchEvent(new CustomEvent("liliumTextDestroyed",{detail:this}))}},{key:"lock",value:function(){this.contentel.removeAttribute("contenteditable")}},{key:"unlock",value:function(){this.contentel.contentEditable=!0}},{key:"createSelectionContext",value:function(e){for(var t=[];e!=this.contentel&&e;)t.push(e),e=e.parentNode;return t}},{key:"selectWord",value:function(e){var t=document.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset);var i=t.collapsed;t.detach();var n=e.focusNode,o=e.focusOffset;e.collapse(e.anchorNode,e.anchorOffset);var r=i?["backward","forward"]:["forward","backward"];e.modify("move",r[0],"character"),e.modify("move",r[1],"word"),e.extend(n,o),e.modify("extend",r[1],"character"),e.modify("extend",r[0],"word")}},{key:"selectParent",value:function(e,t){var i=document.createRange();i.selectNode(t||e.focusNode.parentNode),window.getSelection().removeAllRanges(),window.getSelection().addRange(i)}},{key:"unwrap",value:function(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);e.remove()}},{key:"_pushToHistory",value:function(e){this.fire("history",e),this.log("Pushing new entry to history"),this._history.mutations.push(e)>this.settings.maxHistoryStack&&this._history.mutations.shift(),this._history.undoStack=[]}},{key:"_observe",value:function(e){var t=this;e.forEach(function(e){return t._pushToHistory(LiliumTextHistoryEntry.fromRecord(e))})}},{key:"_takeSnapshot",value:function(e){this.contentel.innerHTML!=this._historylastState&&(this._historylastState=this.contentel.innerHTML,this._pushToHistory(LiliumTextHistoryEntry.fromSnapshot(this._historylastState,e)))}},{key:"_startHistory",value:function(){var e=this;this.snapshotTimerID=setInterval(function(){e._takeSnapshot()},this.settings.historyInterval)}},{key:"resetSnapshot",value:function(){this.snapshotTimerID&&clearInterval(this.snapshotTimerID),this._startHistory()}},{key:"takeSnapshot",value:function(){this.resetSnapshot(),this._takeSnapshot(!0)}},{key:"isRangeInEditor",value:function(e){return e&&e.startContainer.compareDocumentPosition(this.contentel)&Node.DOCUMENT_POSITION_CONTAINS}},{key:"insert",value:function(e){var t=this.restoreSelection(),i=this.getRange();this.isRangeInEditor(i)||(this.contentel.focus(),i=this.storeRange()),i.insertNode(e),i.setStartAfter(e),t.removeAllRanges(),t.addRange(i)}},{key:"insertBlock",value:function(e){var t=this.restoreSelection(),i=this.createSelectionContext(t.focusNode),n=i[i.length-1];if(t.focusNode==this.contentel){this.contentel.insertBefore(e,this.contentel.children[t.focusOffset]);var o=t.getRangeAt(0).cloneRange();o.setEndAfter(e),o.collapse(!1),t.removeAllRanges(),t.addRange(o)}else{if(n&&n.nextSibling){var r=n;r&&r.parentNode.insertBefore(e,0==t.focusOffset?r:r.nextSibling)}else this.contentel.appendChild(e);if(0!=t.focusOffset){var s=t.getRangeAt(0).cloneRange();s.setEndAfter(e),s.collapse(!1),t.removeAllRanges(),t.addRange(s)}}}},{key:"_focused",value:function(){var e=this.fire("focus");this.focused=!0,e&&e.includes(!1)||(this._tempSelection=void 0,this._tempRange=void 0,document.execCommand("defaultParagraphSeparator",!1,this.settings.breaktag))}},{key:"_clicked",value:function(e){var t=window.getSelection();if(t.focusNode&&t.focusNode.parentElement){var i=this.createSelectionContext(t.focusNode),n=t.focusNode.parentElement;this.fire("clicked",{context:i,event:e,selection:t,element:n})}else this.fire("clicked",{selection:t,event:e});if(e.target==this.contentel&&this.contentel.offsetHeight-e.offsetY<60&&editor.contentel.scrollHeight-this.contentel.getBoundingClientRect().height-this.contentel.scrollTop<30){var o=document.createElement(this.settings.breaktag);o.appendChild(document.createElement("br")),this.contentel.appendChild(o);var r=document.createRange();r.selectNode(o),r.collapse(!0),t.removeAllRanges(),t.addRange(r),this.contentel.scrollTop=editor.contentel.scrollHeight-this.contentel.getBoundingClientRect().height}}},{key:"redo",value:function(){if(0!=this._history.undoStack.length){this.log("Restoring from undo stack");var e=this._history.undoStack.pop();this._history.mutations.push(e.mutation),this.content=e.markup,this.resetSnapshot(),this.fire("redo")}return!1}},{key:"undo",value:function(){if(0!=this._history.mutations.length){this.log("Going up one state in history");var e=this._history.mutations.pop(),t=this.content;if(!e.undo(this))return this.undo();this.log("Pushing to undo stack"),this._history.undoStack.push({markup:t,mutation:e}),this.resetSnapshot(),this.fire("undo")}else this.log("Restored original content"),this.content=this.settings.content;return!1}},{key:"storeRange",value:function(e){if(e)this._tempRange=e;else{var t=window.getSelection();if("None"!=t.type&&t.focusNode)this._tempRange=t.getRangeAt(0).cloneRange();else{var i=document.createRange();i.setStart(this.contentel,0),this._tempRange=i}}return this._tempRange}},{key:"restoreSelection",value:function(){var e=window.getSelection();return this.focused||(e.removeAllRanges(),e.addRange(this.getRange())),e}},{key:"getRange",value:function(){return this._tempRange||this.storeRange()}},{key:"_blurred",value:function(){this.focused=!1,this.storeRange(),this.fire("blur")}},{key:"_keydown",value:function(e){if((e.ctrlKey||e.metaKey)&&"z"==String.fromCharCode(e.which).toLowerCase())return e.preventDefault(),this.undo(),!1}},{key:"_pasted",value:function(e){var t=e.clipboardData||window.clipboardData,i=this.fire("paste",{dataTransfer:t,event:e});if(!i||!i.includes(!1))if(t.types.includes("text/html")){e.stopPropagation(),e.preventDefault();var n=t.getData("text/html"),o=document.createElement("div");o.innerHTML=n,this.settings.removepastedstyles&&(Array.prototype.forEach.call(o.querySelectorAll("*"),function(e){return e.removeAttribute("style")}),Array.prototype.forEach.call(o.querySelectorAll("style"),function(e){return e.remove()})),document.execCommand("insertHTML",!1,o.innerHTML)}else{var r=t.getData("text");this.settings.urldetection.exec(r)&&(e.stopPropagation(),e.preventDefault(),document.execCommand("createLink",!1,r))}}},{key:"_registerAllPlugins",value:function(){var t=this;this.settings.plugins&&this.settings.plugins.forEach(function(e){return t.registerPlugin(e)})}},{key:"registerPlugin",value:function(e){var t=new e(this);this.log("Registering plugin with id "+t.identifier),t.register(),this._plugins.push(t)}},{key:"unregisterPlugin",value:function(i){var n=-1,e=this._plugins.find(function(e,t){if(e.identifier==i)return n=t,e});e&&(e&&e.unregister(),this._plugins.splice(n,1))}},{key:"_init",value:function(){this.log("Initializing LiliumText instance"),this.toolbarel=document.createElement("div"),this.toolbarel.className="liliumtext-topbar",this.contentel=document.createElement("div"),this.contentel.contentEditable=!0,this.contentel.className="liliumtext-editor",this.codeel=document.createElement("pre"),this.codeel.contentEditable=!0,this.codeel.className="liliumtext-code",this.wrapperel.appendChild(this.toolbarel),this.wrapperel.appendChild(this.contentel),this.wrapperel.appendChild(this.codeel),this.settings.content&&this.settings.initrender?this.contentel.innerHTML=this.settings.content:this.contentel.appendChild(document.createElement(this.settings.breaktag)),this.contentel.addEventListener("paste",this.settings.onpaste||this._pasted.bind(this)),this.contentel.addEventListener("focus",this._focused.bind(this)),this.contentel.addEventListener("blur",this._blurred.bind(this)),this.contentel.addEventListener("click",this._clicked.bind(this)),this.contentel.addEventListener("keydown",this._keydown.bind(this)),this._history={mutations:[],undoStack:[]},this._startHistory(),this._registerAllPlugins(),this.fire("init"),this.log("Initialized LiliumText instance"),this.initialized=!0}},{key:"createCommandSet",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];-1===t?this.commandsets=[e].concat(_toConsumableArray(this.commandsets)):t<this.commandsets.length?this.commandsets=[].concat(_toConsumableArray(this.commandsets.slice(0,t)),[e],_toConsumableArray(this.commandsets.slice(t))):this.commandsets.push(e),i&&this.render()}},{key:"addCommand",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.commandsets.length-1,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=this.commandsets[t];n?n.push(e):this.commandsets.push([e]),i&&this.render()}},{key:"bind",value:function(e,t){this.hooks[e]?this.hooks[e].push(t):this.hooks[e]=[t]}},{key:"fire",value:function(e,t){var i=this;return this.hooks[e]&&this.hooks[e].map(function(e){return e(i,t)})}},{key:"toggleCode",value:function(){return this.log("Toggled code view"),this.codeview=!this.codeview,this.codeview?this.codeel.textContent=this.contentel.innerHTML:this.contentel.innerHTML=this.codeel.textContent,this.codeel.classList[this.codeview?"add":"remove"]("visible"),this.contentel.classList[this.codeview?"add":"remove"]("invisible"),this.fire("code",this.codeview),!0}},{key:"render",value:function(){var i=this;this.log("Rendering LiliumText instance"),this.fire("willrender"),this.log("Clearing toolbar"),this.toolbarel.firstElementChild&&this.toolbarel.firstElementChild.remove(),this.log("Rendering toolbar");var n=document.createElement("div");n.className="liliumtext-commands",this.commandsets.forEach(function(e){var t=document.createElement("div");t.className="liliumtext-commandset",n.appendChild(t),e.forEach(function(e){t.appendChild(e.make(i))})}),this.contentel.style.height=this.settings.height,this.codeel.style.height=this.settings.height,this.wrapperel.style.width=this.settings.width,this.toolbarel.appendChild(n),this.fire("render"),this.log("Done rendering")}},{key:"toString",value:function(){return this.content}},{key:"describe",value:function(){var i=this;return this.settings.dev?"[Development LiliumText Editor instance] Wraps DOM element with ID "+(this.wrapperel.id||"[No ID]")+". This instance currently has "+Object.keys(this.hooks).reduce(function(e,t){return e+i.hooks[t].length},0)+" event hooks.":"[LiliumText Editor]"}},{key:"content",set:function(e){var t={markup:e};this.fire("set",t),this.contentel.innerHTML=t.markup},get:function(){var e={markup:this.contentel.innerHTML};this.fire("get",e);return e.markup}}]),n}();LiliumText.instances={},"undefined"!=typeof module&&(module.exports={LiliumText:LiliumText,LiliumTextCustomCommand:LiliumTextCustomCommand,LiliumTextWebCommand:LiliumTextWebCommand,LiliumTextCommand:LiliumTextCommand,LiliumTextPlugin:LiliumTextPlugin});